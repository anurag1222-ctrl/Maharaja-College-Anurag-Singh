<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Profiles - Maharaja College</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="dashboard">
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2 id="portalTitle">ğŸ“š Portal</h2>
                <button class="close-btn" id="closeSidebar">Ã—</button>
            </div>
            <ul class="nav-menu" id="navMenu"></ul>
        </nav>
        <main class="main-content">
            <header class="top-bar">
                <button class="menu-btn" id="menuBtn">â˜°</button>
                <h1>ğŸ‘¤ Student Profiles</h1>
                <div class="user-info">
                    <span id="userName">User</span>
                </div>
            </header>
            <div class="content">
                <!-- Student View -->
                <div id="studentView" style="display:none;">
                    <div class="section">
                        <div class="profile-header">
                            <div class="profile-avatar">ğŸ“</div>
                            <div class="profile-info">
                                <h2 id="studentName">Student Name</h2>
                                <p id="studentRoll">Roll Number</p>
                                <p id="studentCourse">Course & Semester</p>
                            </div>
                            <button class="btn btn-primary" onclick="editStudentProfile()">âœï¸ Edit Profile</button>
                        </div>
                    </div>

                    <div class="section">
                        <h3>ğŸ“‹ Personal Information</h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <label>ğŸ“… Date of Birth</label>
                                <p id="infoDob">-</p>
                            </div>
                            <div class="info-item">
                                <label>ğŸ“ Phone</label>
                                <p id="infoPhone">-</p>
                            </div>
                            <div class="info-item">
                                <label>ğŸ“§ Email</label>
                                <p id="infoEmail">-</p>
                            </div>
                            <div class="info-item">
                                <label>ğŸ  Address</label>
                                <p id="infoAddress">-</p>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h3>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Parent Information</h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <label>Father's Name</label>
                                <p id="parentFather">-</p>
                            </div>
                            <div class="info-item">
                                <label>Mother's Name</label>
                                <p id="parentMother">-</p>
                            </div>
                            <div class="info-item">
                                <label>Parent Phone</label>
                                <p id="parentPhone">-</p>
                            </div>
                            <div class="info-item">
                                <label>Parent Email</label>
                                <p id="parentEmail">-</p>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h3>ğŸ¥ Medical Information</h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <label>Blood Group</label>
                                <p id="medicalBlood">-</p>
                            </div>
                            <div class="info-item">
                                <label>Allergies</label>
                                <p id="medicalAllergies">None</p>
                            </div>
                            <div class="info-item">
                                <label>Medical Conditions</label>
                                <p id="medicalConditions">None</p>
                            </div>
                            <div class="info-item">
                                <label>Emergency Contact</label>
                                <p id="medicalEmergency">-</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Teacher/Admin View -->
                <div id="adminView" style="display:none;">
                    <div class="section">
                        <div class="section-header">
                            <h2>ğŸ‘¥ All Student Profiles</h2>
                            <div class="search-bar">
                                <input type="text" id="searchStudents" placeholder="ğŸ” Search students..." onkeyup="searchStudents()">
                            </div>
                        </div>
                        <div id="studentsList" class="students-grid"></div>
                    </div>
                </div>

                <!-- Edit Profile Modal -->
                <div id="editProfileModal" class="modal" style="display:none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>âœï¸ Edit Student Profile</h3>
                            <button class="close-btn" onclick="closeEditModal()">Ã—</button>
                        </div>
                        <form id="profileForm" class="form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>ğŸ‘¤ Full Name</label>
                                    <input type="text" id="editName" required>
                                </div>
                                <div class="form-group">
                                    <label>ğŸ“… Date of Birth</label>
                                    <input type="date" id="editDob" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>ğŸ“ Phone Number</label>
                                <input type="tel" id="editPhone">
                            </div>
                            
                            <div class="form-group">
                                <label>ğŸ  Address</label>
                                <textarea id="editAddress" rows="3"></textarea>
                            </div>

                            <h4>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Parent Information</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Father's Name</label>
                                    <input type="text" id="editFather">
                                </div>
                                <div class="form-group">
                                    <label>Mother's Name</label>
                                    <input type="text" id="editMother">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Parent Phone</label>
                                    <input type="tel" id="editParentPhone">
                                </div>
                                <div class="form-group">
                                    <label>Parent Email</label>
                                    <input type="email" id="editParentEmail">
                                </div>
                            </div>

                            <h4>ğŸ¥ Medical Information</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Blood Group</label>
                                    <select id="editBloodGroup">
                                        <option value="">Select</option>
                                        <option value="A+">A+</option>
                                        <option value="A-">A-</option>
                                        <option value="B+">B+</option>
                                        <option value="B-">B-</option>
                                        <option value="O+">O+</option>
                                        <option value="O-">O-</option>
                                        <option value="AB+">AB+</option>
                                        <option value="AB-">AB-</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Emergency Contact</label>
                                    <input type="tel" id="editEmergencyContact">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Allergies</label>
                                <textarea id="editAllergies" placeholder="List any allergies..." rows="2"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>Medical Conditions</label>
                                <textarea id="editConditions" placeholder="List any medical conditions..." rows="2"></textarea>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">ğŸ’¾ Save Profile</button>
                                <button type="button" class="btn btn-secondary" onclick="closeEditModal()">âŒ Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="js/dataHandler.js"></script>
    <script>
        const user = DataHandler.getCurrentUser();
        if (!user) window.location.href = 'index.html';
        
        const isStudent = user.type === 'student';
        const isTeacher = user.type === 'teacher' || user.type === 'admin';
        
        document.getElementById('portalTitle').textContent = isStudent ? 'ğŸ“ Student Portal' : 'ğŸ‘¨â€ğŸ« Teacher Portal';
        document.getElementById('userName').textContent = user.name;
        
        // Navigation setup
        const navMenu = document.getElementById('navMenu');
        const dashboardLink = isStudent ? 'studentDashboard.html' : 'teacherDashboard.html';
        navMenu.innerHTML = `
            <li><a href="${dashboardLink}">ğŸ“Š Dashboard</a></li>
            <li><a href="student-profiles.html" class="active">ğŸ‘¤ Profiles</a></li>
            <li><a href="timetable.html">ğŸ“… Timetable</a></li>
            <li><a href="attendance.html">ğŸ“‹ Attendance</a></li>
            <li><a href="grades.html">ğŸ“Š Grades</a></li>
            <li><a href="fees.html">ğŸ’° Fees</a></li>
            <li><a href="materials.html">ğŸ“š Materials</a></li>
            <li><a href="tests.html">ğŸ“ Tests</a></li>
            <li><a href="performance.html">ğŸ“ˆ Performance</a></li>
            <li><a href="notices.html">ğŸ“¢ Notices</a></li>
            <li><a href="chat.html">ğŸ’¬ Group Chat</a></li>
            <li><a href="#" id="logoutBtn">ğŸšª Logout</a></li>
        `;

        document.getElementById('logoutBtn').addEventListener('click', (e) => {
            e.preventDefault();
            DataHandler.logout();
            window.location.href = 'index.html';
        });

        if (isStudent) {
            document.getElementById('studentView').style.display = 'block';
            loadStudentProfile();
        } else {
            document.getElementById('adminView').style.display = 'block';
            loadAllStudents();
        }

        function loadStudentProfile() {
            const profiles = DataHandler.getStudentProfiles();
            const studentProfile = profiles.find(p => p.studentId === user.id) || createDefaultProfile();
            
            // Populate student view
            document.getElementById('studentName').textContent = user.name;
            document.getElementById('studentRoll').textContent = `Roll No: ${user.rollNumber}`;
            document.getElementById('studentCourse').textContent = `${user.course} Semester ${user.semester}`;
            
            document.getElementById('infoDob').textContent = user.dob || '-';
            document.getElementById('infoPhone').textContent = user.phone || '-';
            document.getElementById('infoEmail').textContent = user.email || '-';
            document.getElementById('infoAddress').textContent = studentProfile.address || '-';
            
            document.getElementById('parentFather').textContent = studentProfile.fatherName || '-';
            document.getElementById('parentMother').textContent = studentProfile.motherName || '-';
            document.getElementById('parentPhone').textContent = studentProfile.parentPhone || '-';
            document.getElementById('parentEmail').textContent = studentProfile.parentEmail || '-';
            
            document.getElementById('medicalBlood').textContent = studentProfile.bloodGroup || '-';
            document.getElementById('medicalAllergies').textContent = studentProfile.allergies || 'None';
            document.getElementById('medicalConditions').textContent = studentProfile.medicalConditions || 'None';
            document.getElementById('medicalEmergency').textContent = studentProfile.emergencyContact || '-';
        }

        function createDefaultProfile() {
            const profile = {
                id: Date.now().toString(),
                studentId: user.id,
                rollNumber: user.rollNumber,
                address: '',
                fatherName: '',
                motherName: '',
                parentPhone: '',
                parentEmail: '',
                bloodGroup: '',
                allergies: '',
                medicalConditions: '',
                emergencyContact: '',
                updatedAt: new Date().toISOString()
            };
            DataHandler.addStudentProfile(profile);
            return profile;
        }

        function editStudentProfile() {
            const profiles = DataHandler.getStudentProfiles();
            const profile = profiles.find(p => p.studentId === user.id) || createDefaultProfile();
            
            // Populate form
            document.getElementById('editName').value = user.name;
            document.getElementById('editDob').value = user.dob || '';
            document.getElementById('editPhone').value = user.phone || '';
            document.getElementById('editAddress').value = profile.address || '';
            document.getElementById('editFather').value = profile.fatherName || '';
            document.getElementById('editMother').value = profile.motherName || '';
            document.getElementById('editParentPhone').value = profile.parentPhone || '';
            document.getElementById('editParentEmail').value = profile.parentEmail || '';
            document.getElementById('editBloodGroup').value = profile.bloodGroup || '';
            document.getElementById('editEmergencyContact').value = profile.emergencyContact || '';
            document.getElementById('editAllergies').value = profile.allergies || '';
            document.getElementById('editConditions').value = profile.medicalConditions || '';
            
            document.getElementById('editProfileModal').style.display = 'block';
        }

        function closeEditModal() {
            document.getElementById('editProfileModal').style.display = 'none';
        }

        document.getElementById('profileForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const profiles = DataHandler.getStudentProfiles();
            const existingIndex = profiles.findIndex(p => p.studentId === user.id);
            
            const updatedProfile = {
                studentId: user.id,
                rollNumber: user.rollNumber,
                address: document.getElementById('editAddress').value,
                fatherName: document.getElementById('editFather').value,
                motherName: document.getElementById('editMother').value,
                parentPhone: document.getElementById('editParentPhone').value,
                parentEmail: document.getElementById('editParentEmail').value,
                bloodGroup: document.getElementById('editBloodGroup').value,
                allergies: document.getElementById('editAllergies').value,
                medicalConditions: document.getElementById('editConditions').value,
                emergencyContact: document.getElementById('editEmergencyContact').value,
                updatedAt: new Date().toISOString()
            };

            if (existingIndex !== -1) {
                updatedProfile.id = profiles[existingIndex].id;
                profiles[existingIndex] = updatedProfile;
            } else {
                updatedProfile.id = Date.now().toString();
                profiles.push(updatedProfile);
            }
            
            DataHandler.saveToStorage('school_student_profiles', profiles);
            alert('âœ… Profile updated successfully!');
            closeEditModal();
            loadStudentProfile();
        });

        // Teacher/Admin functions
        function loadAllStudents() {
            searchStudents();
        }

        function searchStudents() {
            const searchTerm = document.getElementById('searchStudents').value.toLowerCase();
            const users = DataHandler.getUsers().filter(u => u.type === 'student');
            const profiles = DataHandler.getStudentProfiles();
            const container = document.getElementById('studentsList');
            
            const filteredStudents = users.filter(student => 
                student.name.toLowerCase().includes(searchTerm) ||
                student.rollNumber.toLowerCase().includes(searchTerm)
            );

            if (filteredStudents.length === 0) {
                container.innerHTML = '<p class="empty-state">No students found</p>';
                return;
            }

            container.innerHTML = filteredStudents.map(student => {
                const profile = profiles.find(p => p.studentId === student.id);
                return `
                    <div class="student-card">
                        <div class="student-header">
                            <div class="student-avatar">ğŸ“</div>
                            <div class="student-info">
                                <h3>${student.name}</h3>
                                <p>${student.rollNumber} â€¢ ${student.course} Sem ${student.semester}</p>
                            </div>
                        </div>
                        <div class="student-details">
                            <p>ğŸ“ ${student.phone || 'Not provided'}</p>
                            <p>ğŸ“§ ${student.email}</p>
                            ${profile ? `<p>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ${profile.fatherName || 'Parent info not provided'}</p>` : ''}
                            ${profile ? `<p>ğŸ¥ ${profile.bloodGroup || 'Medical info not provided'}</p>` : ''}
                        </div>
                        <div class="student-actions">
                            <button class="btn btn-small btn-primary" onclick="viewFullProfile('${student.id}')">ğŸ‘ï¸ View Full</button>
                            <button class="btn btn-small btn-secondary" onclick="exportStudentData('${student.id}')">ğŸ“¤ Export</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function viewFullProfile(studentId) {
            const student = DataHandler.getUsers().find(u => u.id === studentId);
            const profile = DataHandler.getStudentProfiles().find(p => p.studentId === studentId);
            
            const profileHTML = `
                <h3>${student.name} - ${student.rollNumber}</h3>
                <div class="profile-details">
                    <p><strong>Course:</strong> ${student.course} Semester ${student.semester}</p>
                    <p><strong>DOB:</strong> ${student.dob || 'Not provided'}</p>
                    <p><strong>Phone:</strong> ${student.phone || 'Not provided'}</p>
                    <p><strong>Email:</strong> ${student.email}</p>
                    ${profile ? `<p><strong>Address:</strong> ${profile.address || 'Not provided'}</p>` : ''}
                    ${profile ? `<p><strong>Father:</strong> ${profile.fatherName || 'Not provided'}</p>` : ''}
                    ${profile ? `<p><strong>Mother:</strong> ${profile.motherName || 'Not provided'}</p>` : ''}
                    ${profile ? `<p><strong>Parent Contact:</strong> ${profile.parentPhone || 'Not provided'}</p>` : ''}
                    ${profile ? `<p><strong>Blood Group:</strong> ${profile.bloodGroup || 'Not provided'}</p>` : ''}
                    ${profile ? `<p><strong>Allergies:</strong> ${profile.allergies || 'None'}</p>` : ''}
                    ${profile ? `<p><strong>Medical Conditions:</strong> ${profile.medicalConditions || 'None'}</p>` : ''}
                </div>
            `;
            
            alert(profileHTML);
        }

        function exportStudentData(studentId) {
            const student = DataHandler.getUsers().find(u => u.id === studentId);
            const profile = DataHandler.getStudentProfiles().find(p => p.studentId === studentId);
            const data = { student, profile };
            
            DataHandler.exportData(data, `student_${student.rollNumber}_profile.json`);
        }

        // Event Listeners
        document.getElementById('menuBtn').addEventListener('click', () => {
            document.getElementById('sidebar').classList.add('active');
        });

        document.getElementById('closeSidebar').addEventListener('click', () => {
            document.getElementById('sidebar').classList.remove('active');
        });
    </script>

    <style>
        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        .profile-avatar {
            font-size: 64px;
        }
        .profile-info h2 {
            margin: 0;
            font-size: 28px;
        }
        .profile-info p {
            margin: 5px 0;
            opacity: 0.9;
        }
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        .info-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #3498db;
        }
        .info-item label {
            font-weight: bold;
            color: #2c3e50;
            display: block;
            margin-bottom: 5px;
        }
        .students-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        .student-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        .student-card:hover {
            transform: translateY(-5px);
        }
        .student-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        .student-avatar {
            font-size: 40px;
        }
        .student-info h3 {
            margin: 0;
            color: #2c3e50;
        }
        .student-info p {
            margin: 5px 0;
            color: #666;
        }
        .student-details p {
            margin: 8px 0;
            color: #555;
        }
        .student-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e1e1e1;
        }
    </style>
</body>
</html>